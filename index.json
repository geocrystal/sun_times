{"repository_name":"sun_times","body":"# ‚òÄÔ∏è sun_times\n\n[![Crystal CI](https://github.com/geocrystal/sun_times/actions/workflows/crystal.yml/badge.svg)](https://github.com/geocrystal/sun_times/actions/workflows/crystal.yml)\n[![GitHub release](https://img.shields.io/github/release/geocrystal/sun_times.svg)](https://github.com/geocrystal/sun_times/releases)\n[![Docs](https://img.shields.io/badge/docs-available-brightgreen.svg)](https://geocrystal.github.io/sun_times/)\n[![License](https://img.shields.io/github/license/geocrystal/sun_times.svg)](https://github.com/geocrystal/sun_times/blob/main/LICENSE)\n\nA simple [Crystal](https://crystal-lang.org) library for calculating üåÖ **sunrise** and üåá **sunset** given latitude, longitude, and date based on\nthe [NOAA Solar Calculator](https://gml.noaa.gov/grad/solcalc/) and formulas from\nJean Meeus' _Astronomical Algorithms (2nd Edition, 1998)_.\n\n## üìä Accuracy\n\nThe library's astronomical constants and algorithms follow authoritative sources (NOAA, JPL, Meeus) and were verified manually against the NOAA Solar Calculator (<https://gml.noaa.gov/grad/solcalc/>).\n\nVerification\n\n- A validation script (`samples/accuracy_check.cr`) compares calculated sunrise, sunset and solar noon against NOAA's apparent times for several locations.\n- The comparison was performed manually by running the script and checking the NOAA site for reference values.\n\nResults\n\n- Calculated times are within the margin of error and are effectively identical to NOAA's apparent times. Differences are typically under 1 minute.\n- Tested locations include New York, London, Tokyo and Sydney. Example: New York on 2025-11-05 matched NOAA apparent sunrise/sunset closely (06:31 / 16:47 local).\n\n## üì¶ Installation\n\n1. Add the dependency to your `shard.yml`:\n\n   ```yaml\n   dependencies:\n     sun_times:\n       github: geocrystal/sun_times\n   ```\n\n2. Run `shards install`\n\n## üíª Usage\n\n```crystal\nrequire \"sun_times\"\n\n# Example: Lviv, Ukraine\n# SunTime.new(latitude : Float64, longitude : Float64)\nsun = SunTimes::SunTime.new(49.8419, 24.0311)\nlocation = Time::Location.load(\"Europe/Kyiv\")\ndate = Time.local\n\nastronomical_dawn_time = sun.astronomical_dawn(date, location)\nnautical_dawn_time = sun.nautical_dawn(date, location)\ncivil_dawn_time = sun.civil_dawn(date, location)\nsunrise_time = sun.sunrise(date, location)\nsolar_noon_time = sun.solar_noon(date, location)\nsunset_time = sun.sunset(date, location)\ncivil_dusk_time = sun.civil_dusk(date, location)\nnautical_dusk_time = sun.nautical_dusk(date, location)\nastronomical_dusk_time = sun.astronomical_dusk(date, location)\ndaylight_length = sun.daylight_length(date, location)\n\nputs \"Timezone: #{location}\"\nputs \"Now:      #{date}\"\nputs\nputs \"=== Twilight Periods ===\"\nputs \"Astronomical dawn:  #{astronomical_dawn_time}\"\nputs \"Nautical dawn:      #{nautical_dawn_time}\"\nputs \"Civil dawn:         #{civil_dawn_time}\"\nputs \"Sunrise:            #{sunrise_time}\"\nputs \"Solar noon:         #{solar_noon_time}\"\nputs \"Sunset:             #{sunset_time}\"\nputs \"Civil dusk:         #{civil_dusk_time}\"\nputs \"Nautical dusk:      #{nautical_dusk_time}\"\nputs \"Astronomical dusk:  #{astronomical_dusk_time}\"\nputs \"\"\nputs \"=== Daylight ===\"\nputs \"Daylight:      #{daylight_length}\"\n```\n\nOutput:\n\n```\nTimezone: Europe/Kyiv\nNow:      2025-11-05 14:05:23 +02:00\n\n=== Twilight Periods ===\nAstronomical dawn:  2025-11-05 05:30:09 +02:00\nNautical dawn:      2025-11-05 06:07:40 +02:00\nCivil dawn:         2025-11-05 06:46:02 +02:00\nSunrise:            2025-11-05 07:20:19 +02:00\nSolar noon:         2025-11-05 12:07:24 +02:00\nSunset:             2025-11-05 16:54:29 +02:00\nCivil dusk:         2025-11-05 17:28:46 +02:00\nNautical dusk:      2025-11-05 18:07:08 +02:00\nAstronomical dusk:  2025-11-05 18:44:39 +02:00\n\n=== Daylight ===\nDaylight:      9h 34m 9s\n```\n\n![readme](https://github.com/geocrystal/sun_times/blob/main/samples/readme.png?raw=true)\n\nYou can also get all solar events as a NamedTuple using the `events` method, which is useful for serialization (e.g., JSON): üìã\n\n```crystal\nrequire \"json\"\nrequire \"sun_times\"\n\nsun = SunTimes::SunTime.new(49.8419, 24.0311)\nlocation = Time::Location.load(\"Europe/Kyiv\")\ndate = Time.local\n\nsun.events(date, location).to_json\n```\n\nOutput\n\n```json\n{\n  \"astronomical_dawn\":\"2025-11-05T05:30:09+02:00\",\n  \"nautical_dawn\":\"2025-11-05T06:07:40+02:00\",\n  \"civil_dawn\":\"2025-11-05T06:46:02+02:00\",\n  \"sunrise\":\"2025-11-05T07:20:19+02:00\",\n  \"solar_noon\":\"2025-11-05T12:07:24+02:00\",\n  \"sunset\":\"2025-11-05T16:54:29+02:00\",\n  \"civil_dusk\":\"2025-11-05T17:28:46+02:00\",\n  \"nautical_dusk\":\"2025-11-05T18:07:08+02:00\",\n  \"astronomical_dusk\":\"2025-11-05T18:44:39+02:00\"\n}\n```\n\n### üåÜ Twilight Periods\n\nThe library supports three types of twilight periods:\n\n- **Civil twilight** üåÖ (sun 6¬∞ below horizon): Enough light for most outdoor activities\n- **Nautical twilight** ‚öì (sun 12¬∞ below horizon): Horizon is still visible for navigation\n- **Astronomical twilight** üî≠ (sun 18¬∞ below horizon): Sky is dark enough for astronomical observations\n\n![image](https://github.com/geocrystal/sun_times/blob/main/samples/twilight_subcategories.png?raw=true)\n\n## üöÄ Performance\n\nThe library is fast as the speed of light! ‚ö° Individual calculations are sub-microsecond, and the `events` method that computes all solar events is still under 4 microseconds per call.\n\nBenchmark results were obtained on Intel(R) Core(TM) i7-8550U (8) @ 4.00 GHz.\n\nYou can run the benchmark with:\n\n```bash\ncrystal run --release samples/benchmark.cr\n```\n\n## ü§ù Contributing\n\n1. Fork it (<https://github.com/geocrystal/sun_times/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## üë• Contributors\n\n- [Anton Maminov](https://github.com/mamantoha) - creator and maintainer\n\n## üìÑ License\n\nThis library is distributed under the MIT license. Please see the LICENSE file.\n","program":{"html_id":"sun_times/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"locations":[],"repository_name":"sun_times","program":true,"enum":false,"alias":false,"const":false,"types":[{"html_id":"sun_times/SunTimes","path":"SunTimes.html","kind":"module","full_name":"SunTimes","name":"SunTimes","abstract":false,"locations":[{"filename":"src/sun_times.cr","line_number":11,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L11"}],"repository_name":"sun_times","program":false,"enum":false,"alias":false,"const":false,"types":[{"html_id":"sun_times/SunTimes/CalculationError","path":"SunTimes/CalculationError.html","kind":"class","full_name":"SunTimes::CalculationError","name":"CalculationError","abstract":false,"superclass":{"html_id":"sun_times/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"sun_times/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"sun_times/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"sun_times/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sun_times.cr","line_number":14,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L14"}],"repository_name":"sun_times","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"sun_times/SunTimes","kind":"module","full_name":"SunTimes","name":"SunTimes"},"doc":"Exception raised when sunrise/sunset calculations cannot be performed\n(e.g., polar night or polar day).","summary":"<p>Exception raised when sunrise/sunset calculations cannot be performed (e.g., polar night or polar day).</p>"},{"html_id":"sun_times/SunTimes/InvalidInputError","path":"SunTimes/InvalidInputError.html","kind":"class","full_name":"SunTimes::InvalidInputError","name":"InvalidInputError","abstract":false,"superclass":{"html_id":"sun_times/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"sun_times/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"sun_times/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"sun_times/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sun_times.cr","line_number":18,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L18"}],"repository_name":"sun_times","program":false,"enum":false,"alias":false,"const":false,"namespace":{"html_id":"sun_times/SunTimes","kind":"module","full_name":"SunTimes","name":"SunTimes"},"doc":"Exception raised when invalid input is provided (e.g., invalid Julian Day).","summary":"<p>Exception raised when invalid input is provided (e.g., invalid Julian Day).</p>"},{"html_id":"sun_times/SunTimes/SunTime","path":"SunTimes/SunTime.html","kind":"class","full_name":"SunTimes::SunTime","name":"SunTime","abstract":false,"superclass":{"html_id":"sun_times/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"sun_times/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"sun_times/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/sun_times.cr","line_number":21,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L21"}],"repository_name":"sun_times","program":false,"enum":false,"alias":false,"const":false,"constants":[{"id":"CORRECTION_ECCENTRICITY","name":"CORRECTION_ECCENTRICITY","value":"0.00534"},{"id":"CORRECTION_OBLIQUITY","name":"CORRECTION_OBLIQUITY","value":"0.00692"},{"id":"DAILY_MOTION","name":"DAILY_MOTION","value":"0.98564736"},{"id":"DEG2RAD","name":"DEG2RAD","value":"Math::PI / 180.0"},{"id":"EARTH_PERIHELION_LONG","name":"EARTH_PERIHELION_LONG","value":"102.9373"},{"id":"EQUATION_CENTER_COEFF_1","name":"EQUATION_CENTER_COEFF_1","value":"1.9148","doc":"Equation of center coefficients (Meeus 1998)","summary":"<p>Equation of center coefficients (Meeus 1998)</p>"},{"id":"EQUATION_CENTER_COEFF_2","name":"EQUATION_CENTER_COEFF_2","value":"0.0200"},{"id":"EQUATION_CENTER_COEFF_3","name":"EQUATION_CENTER_COEFF_3","value":"0.0003"},{"id":"JULIAN_BASE_OFFSET","name":"JULIAN_BASE_OFFSET","value":"1524.5"},{"id":"JULIAN_EPOCH_J2000","name":"JULIAN_EPOCH_J2000","value":"2451545.0"},{"id":"JULIAN_EPOCH_OFFSET","name":"JULIAN_EPOCH_OFFSET","value":"4716"},{"id":"JULIAN_MIDNIGHT_FIX","name":"JULIAN_MIDNIGHT_FIX","value":"0.5"},{"id":"JULIAN_MONTH_FACTOR","name":"JULIAN_MONTH_FACTOR","value":"30.6001"},{"id":"JULIAN_UNIX_EPOCH","name":"JULIAN_UNIX_EPOCH","value":"2440587.5"},{"id":"JULIAN_YEAR_DAYS","name":"JULIAN_YEAR_DAYS","value":"365.25"},{"id":"MEAN_ANOMALY_AT_EPOCH","name":"MEAN_ANOMALY_AT_EPOCH","value":"357.5291"},{"id":"OBLIQUITY","name":"OBLIQUITY","value":"23.43929111"},{"id":"RAD2DEG","name":"RAD2DEG","value":"180.0 / Math::PI"},{"id":"SECONDS_PER_DAY","name":"SECONDS_PER_DAY","value":"86400.0"},{"id":"SUN_ALTITUDE_ASTRONOMICAL","name":"SUN_ALTITUDE_ASTRONOMICAL","value":"-18.0"},{"id":"SUN_ALTITUDE_CIVIL","name":"SUN_ALTITUDE_CIVIL","value":"-6.0"},{"id":"SUN_ALTITUDE_NAUTICAL","name":"SUN_ALTITUDE_NAUTICAL","value":"-12.0"},{"id":"SUN_ALTITUDE_RISE_SET","name":"SUN_ALTITUDE_RISE_SET","value":"-0.8333"}],"namespace":{"html_id":"sun_times/SunTimes","kind":"module","full_name":"SunTimes","name":"SunTimes"},"constructors":[{"html_id":"new(latitude:Float64,longitude:Float64)-class-method","name":"new","doc":"Initializes a SunTime calculator for the given latitude and longitude.\n\n`latitude`  - Degrees north (negative for south)\n`longitude` - Degrees east (negative for west)\n\nExample:\n\n```\nSunTimes::SunTime.new(48.87, 2.67)   # Paris\nSunTimes::SunTime.new({48.87, 2.67}) # Paris\n```","summary":"<p>Initializes a SunTime calculator for the given latitude and longitude.</p>","abstract":false,"args":[{"name":"latitude","external_name":"latitude","restriction":"Float64"},{"name":"longitude","external_name":"longitude","restriction":"Float64"}],"args_string":"(latitude : Float64, longitude : Float64)","args_html":"(latitude : Float64, longitude : Float64)","location":{"filename":"src/sun_times.cr","line_number":84,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L84"},"def":{"name":"new","args":[{"name":"latitude","external_name":"latitude","restriction":"Float64"},{"name":"longitude","external_name":"longitude","restriction":"Float64"}],"visibility":"Public","body":"_ = allocate\n_.initialize(latitude, longitude)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false},{"html_id":"new(coords:Tuple(Float64,Float64))-class-method","name":"new","doc":"Initializes a SunTime calculator for the given latitude and longitude.\n\n`latitude`  - Degrees north (negative for south)\n`longitude` - Degrees east (negative for west)\n\nExample:\n\n```\nSunTimes::SunTime.new(48.87, 2.67)   # Paris\nSunTimes::SunTime.new({48.87, 2.67}) # Paris\n```","summary":"<p>Initializes a SunTime calculator for the given latitude and longitude.</p>","abstract":false,"args":[{"name":"coords","external_name":"coords","restriction":"Tuple(Float64, Float64)"}],"args_string":"(coords : Tuple(Float64, Float64))","args_html":"(coords : Tuple(Float64, Float64))","location":{"filename":"src/sun_times.cr","line_number":88,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L88"},"def":{"name":"new","args":[{"name":"coords","external_name":"coords","restriction":"Tuple(Float64, Float64)"}],"visibility":"Public","body":"_ = allocate\n_.initialize(coords)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"},"external_var":false}],"instance_methods":[{"html_id":"astronomical_dawn(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"astronomical_dawn","doc":"Returns the time of astronomical dawn (beginning of astronomical twilight).\nAstronomical twilight occurs when the sun is 18¬∞ below the horizon.\nDuring this period, the sky is dark enough for astronomical observations.\n\nArguments:\n\n- `date` - Time (date portion is used; time of day ignored)\n- `location` - Optional Time::Location for local conversion\n\nReturns:\n`Time` in UTC or converted to the provided location.\n\nRaises:\n`CalculationError` if there is no astronomical dawn (polar night or polar day).\n\nExample:\n\n```\nsun.astronomical_dawn(Time.local(2025, 11, 2), paris)\n=> 2025-11-02 06:37:00 UTC\n```","summary":"<p>Returns the time of astronomical dawn (beginning of astronomical twilight).</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":358,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L358"},"def":{"name":"astronomical_dawn","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"(astronomical_dawn?(date, location)) ||\n(raise(CalculationError.new(\"No astronomical dawn occurs on this date for this location\")))"},"external_var":false},{"html_id":"astronomical_dawn?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"astronomical_dawn?","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":408,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L408"},"def":{"name":"astronomical_dawn?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: true, altitude: SUN_ALTITUDE_ASTRONOMICAL)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false},{"html_id":"astronomical_dusk(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"astronomical_dusk","doc":"Returns the time of astronomical dusk (end of astronomical twilight).\n\nSee `astronomical_dawn` for details about astronomical twilight.","summary":"<p>Returns the time of astronomical dusk (end of astronomical twilight).</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":366,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L366"},"def":{"name":"astronomical_dusk","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"(astronomical_dusk?(date, location)) ||\n(raise(CalculationError.new(\"No astronomical dusk occurs on this date for this location\")))"},"external_var":false},{"html_id":"astronomical_dusk?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"astronomical_dusk?","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":414,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L414"},"def":{"name":"astronomical_dusk?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: false, altitude: SUN_ALTITUDE_ASTRONOMICAL)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false},{"html_id":"civil_dawn(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"civil_dawn","doc":"Returns the time of civil dawn (beginning of civil twilight).\nCivil twilight occurs when the sun is 6¬∞ below the horizon.\nDuring this period, there is enough light for most outdoor activities.\n\nArguments:\n\n- `date` - Time (date portion is used; time of day ignored)\n- `location` - Optional Time::Location for local conversion\n\nReturns:\n\n`Time` in UTC or converted to the provided location.\n\nRaises:\n\n`CalculationError` if there is no civil dawn (polar night or polar day).\n\nExample:\n\n```\nsun.civil_dawn(Time.local(2025, 11, 2), paris)\n=> 2025-11-02 06:37:00 UTC\n```","summary":"<p>Returns the time of civil dawn (beginning of civil twilight).</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":289,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L289"},"def":{"name":"civil_dawn","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"(civil_dawn?(date, location)) ||\n(raise(CalculationError.new(\"No civil dawn occurs on this date for this location\")))"},"external_var":false},{"html_id":"civil_dawn?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"civil_dawn?","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":384,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L384"},"def":{"name":"civil_dawn?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: true, altitude: SUN_ALTITUDE_CIVIL)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false},{"html_id":"civil_dusk(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"civil_dusk","doc":"Returns the time of civil dusk (end of civil twilight).\n\nSee `civil_dawn` for details about civil twilight.","summary":"<p>Returns the time of civil dusk (end of civil twilight).</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":297,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L297"},"def":{"name":"civil_dusk","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"(civil_dusk?(date, location)) ||\n(raise(CalculationError.new(\"No civil dusk occurs on this date for this location\")))"},"external_var":false},{"html_id":"civil_dusk?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"civil_dusk?","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":390,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L390"},"def":{"name":"civil_dusk?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: false, altitude: SUN_ALTITUDE_CIVIL)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false},{"html_id":"daylight_length(date:Time,location:Time::Location|Nil=nil):Time::Span-instance-method","name":"daylight_length","doc":"Returns the duration of daylight (time between sunrise and sunset)\nfor the given date and location.\n\nArguments:\n\n- `date` - Time (only date portion is used)\n- `location` - Optional Time::Location for local conversion\n\nReturns:\n\n`Time::Span` representing total daylight duration.\n\nReturns `Time::Span.zero` if there is no sunrise/sunset (polar night or polar day).\n\nExample:\n\n```\nsun.daylight_length(Time.local(2025, 11, 2), paris)\n=> 9 hours, 50 minutes (approx)\n```","summary":"<p>Returns the duration of daylight (time between sunrise and sunset) for the given date and location.</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time::Span","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time::Span","location":{"filename":"src/sun_times.cr","line_number":212,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L212"},"def":{"name":"daylight_length","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time::Span","visibility":"Public","body":"jd_rise = calculate(date, rise: true, altitude: SUN_ALTITUDE_RISE_SET)\njd_set = calculate(date, rise: false, altitude: SUN_ALTITUDE_RISE_SET)\n\n\nif jd_rise.nan? || jd_set.nan?\n  return Time::Span.zero\nend\n\nrise = from_julian(jd_rise, location)\nset = from_julian(jd_set, location)\n\nset - rise\n"},"external_var":false},{"html_id":"events(date:Time,location:Time::Location|Nil=nil)-instance-method","name":"events","doc":"Returns all solar events for the given date and location as a NamedTuple.\n\nArguments:\n\n- `date` - Time (only date portion is used)\n- `location` - Optional Time::Location for local conversion\n\nReturns:\n\n`NamedTuple` with all solar events:\n\n- `astronomical_dawn` - Time?\n- `nautical_dawn` - Time?\n- `civil_dawn` - Time?\n- `sunrise` - Time?\n- `solar_noon` - Time (always available)\n- `sunset` - Time?\n- `civil_dusk` - Time?\n- `nautical_dusk` - Time?\n- `astronomical_dusk` - Time?\n\nExample:\n\n```\nsun.events(Time.local(2025, 11, 2), paris)\n=> {astronomical_dawn: ..., nautical_dawn: ..., ...}\n```","summary":"<p>Returns all solar events for the given date and location as a NamedTuple.</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil)","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>)","location":{"filename":"src/sun_times.cr","line_number":252,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L252"},"def":{"name":"events","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"visibility":"Public","body":"{\n  astronomical_dawn: astronomical_dawn?(date, location),\n  nautical_dawn: nautical_dawn?(date, location),\n  civil_dawn: civil_dawn?(date, location),\n  sunrise: sunrise?(date, location),\n  solar_noon: solar_noon(date, location),\n  sunset: sunset?(date, location),\n  civil_dusk: civil_dusk?(date, location),\n  nautical_dusk: nautical_dusk?(date, location),\n  astronomical_dusk: astronomical_dusk?(date, location),\n}"},"external_var":false},{"html_id":"latitude:Float64-instance-method","name":"latitude","abstract":false,"location":{"filename":"src/sun_times.cr","line_number":22,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L22"},"def":{"name":"latitude","return_type":"Float64","visibility":"Public","body":"@latitude"},"external_var":false},{"html_id":"longitude:Float64-instance-method","name":"longitude","abstract":false,"location":{"filename":"src/sun_times.cr","line_number":23,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L23"},"def":{"name":"longitude","return_type":"Float64","visibility":"Public","body":"@longitude"},"external_var":false},{"html_id":"nautical_dawn(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"nautical_dawn","doc":"Returns the time of nautical dawn (beginning of nautical twilight).\nNautical twilight occurs when the sun is 12¬∞ below the horizon.\nDuring this period, the horizon is still visible for navigation.\n\nArguments:\n\n- `date` - Time (date portion is used; time of day ignored)\n- `location` - Optional Time::Location for local conversion\n\nReturns:\n\n`Time` in UTC or converted to the provided location.\n\nRaises:\n\n`CalculationError` if there is no nautical dawn (polar night or polar day).\n\nExample:\n\n```\nsun.nautical_dawn(Time.local(2025, 11, 2), paris)\n=> 2025-11-02 06:37:00 UTC\n```","summary":"<p>Returns the time of nautical dawn (beginning of nautical twilight).</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":325,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L325"},"def":{"name":"nautical_dawn","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"(nautical_dawn?(date, location)) ||\n(raise(CalculationError.new(\"No nautical dawn occurs on this date for this location\")))"},"external_var":false},{"html_id":"nautical_dawn?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"nautical_dawn?","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":396,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L396"},"def":{"name":"nautical_dawn?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: true, altitude: SUN_ALTITUDE_NAUTICAL)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false},{"html_id":"nautical_dusk(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"nautical_dusk","doc":"Returns the time of nautical dusk (end of nautical twilight).\nSee `nautical_dawn` for details about nautical twilight.","summary":"<p>Returns the time of nautical dusk (end of nautical twilight).</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":332,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L332"},"def":{"name":"nautical_dusk","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"(nautical_dusk?(date, location)) ||\n(raise(CalculationError.new(\"No nautical dusk occurs on this date for this location\")))"},"external_var":false},{"html_id":"nautical_dusk?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"nautical_dusk?","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":402,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L402"},"def":{"name":"nautical_dusk?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: false, altitude: SUN_ALTITUDE_NAUTICAL)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false},{"html_id":"solar_noon(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"solar_noon","doc":"Returns the UTC or local time of solar noon (Sun's highest point) for the given date.\n\nSolar noon corresponds to the moment when the Sun crosses the local meridian.\nThis method uses the same underlying model as sunrise/sunset calculations.\n\nArguments:\n\n- `date` - Time (only the date portion is used)\n- `location` - Optional Time::Location for local conversion\n\nReturns:\n\n`Time` of local solar noon (UTC by default)\n\nExample:\n\n```\nsun.solar_noon(Time.local(2025, 11, 2), paris)\n=> 2025-11-02 12:32:50 +01:00\n```","summary":"<p>Returns the UTC or local time of solar noon (Sun's highest point) for the given date.</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":164,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L164"},"def":{"name":"solar_noon","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"jd = julian_day(date)\n\n\nn = (jd - JULIAN_EPOCH_J2000) - (@longitude / 360.0)\n\n\nmean_anomaly = normalize_angle(MEAN_ANOMALY_AT_EPOCH + (DAILY_MOTION * (jd - JULIAN_EPOCH_J2000)))\n\n\nlambda_sun = normalize_angle(((((mean_anomaly + (EQUATION_CENTER_COEFF_1 * (Math.sin(mean_anomaly * DEG2RAD)))) + (EQUATION_CENTER_COEFF_2 * (Math.sin((2 * mean_anomaly) * DEG2RAD)))) + (EQUATION_CENTER_COEFF_3 * (Math.sin((3 * mean_anomaly) * DEG2RAD)))) + EARTH_PERIHELION_LONG) + 180.0)\n\n\nj_transit = ((JULIAN_EPOCH_J2000 + n) + (CORRECTION_ECCENTRICITY * (Math.sin(mean_anomaly * DEG2RAD)))) - (CORRECTION_OBLIQUITY * (Math.sin((2 * lambda_sun) * DEG2RAD)))\n\nfrom_julian(j_transit, location)\n"},"external_var":false},{"html_id":"sunrise(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"sunrise","doc":"Returns the UTC time of sunrise for the given date.\n\nArguments:\n\n- `date` - Time (date portion is used; time of day ignored)\n- `location` - Optional Time::Location for local conversion\n\nReturns:\n\n`Time` in UTC or converted to the provided location.\n\nRaises:\n\n`CalculationError` if there is no sunrise (polar night or polar day).\n\nExample:\n\n```\nsun.sunrise(Time.local(2025, 11, 2))\n=> 2025-11-02 06:37:00 UTC\n```","summary":"<p>Returns the UTC time of sunrise for the given date.</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":118,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L118"},"def":{"name":"sunrise","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"t = sunrise?(date, location)\nif t.nil?\n  raise(CalculationError.new(\"No sunrise occurs on this date for this location (polar night/day)\"))\nend\nt\n"},"external_var":false},{"html_id":"sunrise?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"sunrise?","doc":"Non-raising convenience variants that return nil when the event does not occur.","summary":"<p>Non-raising convenience variants that return nil when the event does not occur.</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":372,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L372"},"def":{"name":"sunrise?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: true, altitude: SUN_ALTITUDE_RISE_SET)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false},{"html_id":"sunset(date:Time,location:Time::Location|Nil=nil):Time-instance-method","name":"sunset","doc":"Returns the UTC time of sunset for the given date.\n\nArguments and behavior are identical to `#sunrise`.\n\nRaises:\n\n`CalculationError` if there is no sunset (polar night or polar day).\n\nExample:\n\n```\nsun.sunset(Time.local(2025, 11, 2))\n=> 2025-11-02 16:47:00 UTC\n```","summary":"<p>Returns the UTC time of sunset for the given date.</p>","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time","location":{"filename":"src/sun_times.cr","line_number":138,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L138"},"def":{"name":"sunset","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time","visibility":"Public","body":"t = sunset?(date, location)\nif t.nil?\n  raise(CalculationError.new(\"No sunset occurs on this date for this location (polar night/day)\"))\nend\nt\n"},"external_var":false},{"html_id":"sunset?(date:Time,location:Time::Location|Nil=nil):Time|Nil-instance-method","name":"sunset?","abstract":false,"args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"args_string":"(date : Time, location : Time::Location | Nil = nil) : Time | Nil","args_html":"(date : Time, location : Time::Location | Nil = <span class=\"n\">nil</span>) : Time | Nil","location":{"filename":"src/sun_times.cr","line_number":378,"url":"https://github.com/geocrystal/sun_times/blob/75a155b1800d6c4e989f80bd430cd00430debe7c/src/sun_times.cr#L378"},"def":{"name":"sunset?","args":[{"name":"date","external_name":"date","restriction":"Time"},{"name":"location","default_value":"nil","external_name":"location","restriction":"Time::Location | ::Nil"}],"return_type":"Time | ::Nil","visibility":"Public","body":"jd = calculate(date, rise: false, altitude: SUN_ALTITUDE_RISE_SET)\nif jd.nan?\n  return nil\nend\nfrom_julian(jd, location)\n"},"external_var":false}]}]}]}}